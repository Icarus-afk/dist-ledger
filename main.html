/dist-ledger/main.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SupplyChain Ledger - Enterprise Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <style>
    :root {
      --distributor-color: #3498db;
      --retailer-color: #2ecc71;
      --main-color: #9b59b6;
    }
    body { 
      padding-top: 0; 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
    }
    .navbar-brand {
      font-weight: bold;
      font-size: 1.4rem;
    }
    .nav-pills .nav-link.active {
      background-color: #343a40;
    }
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 100;
      padding: 48px 0 0;
      box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
      background-color: #343a40;
      color: white;
    }
    .sidebar .nav-link {
      color: rgba(255, 255, 255, .75);
      font-weight: 500;
    }
    .sidebar .nav-link:hover {
      color: #fff;
    }
    .sidebar .nav-link.active {
      color: #fff;
    }
    .main-content {
      padding-top: 20px;
      margin-left: 240px;
      padding-left: 15px;
      padding-right: 15px;
    }
    .card {
      margin-bottom: 20px;
      box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
      border: none;
    }
    .card-header {
      background-color: #fff;
      font-weight: bold;
      border-bottom: 2px solid #f0f0f0;
    }
    .top-header {
      background-color: #343a40;
      color: white;
      padding: 10px 0;
    }
    .top-header select {
      background-color: #495057;
      color: white;
      border: 1px solid #6c757d;
    }
    .top-header select:focus {
      background-color: #495057;
      color: white;
    }
    .department-icon {
      width: 24px;
      height: 24px;
      display: inline-block;
      margin-right: 10px;
      border-radius: 50%;
    }
    .distributor { background-color: var(--distributor-color); }
    .retailer { background-color: var(--retailer-color); }
    .main-chain { background-color: var(--main-color); }
    
    .flow-diagram {
      position: relative;
      padding: 30px 20px;
      background-color: #f8f9fa;
      border-radius: 6px;
    }
    .node {
      padding: 15px;
      border-radius: 8px;
      color: white;
      text-align: center;
      position: relative;
      margin-bottom: 20px;
    }
    .node-distributor {
      background-color: var(--distributor-color);
    }
    .node-retailer {
      background-color: var(--retailer-color);
    }
    .node-main {
      background-color: var(--main-color);
    }
    .flow-arrow {
      position: absolute;
      font-size: 24px;
      color: #6c757d;
    }
    .badge-role {
      background-color: #17a2b8;
      color: white;
      font-size: 0.8rem;
      margin-left: 10px;
    }
    .transaction-log {
      max-height: 300px;
      overflow-y: auto;
    }
    .network-status-indicator {
      height: 10px;
      width: 10px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }
    .status-online {
      background-color: #28a745;
    }
    .status-offline {
      background-color: #dc3545;
    }
    .chain-title {
      border-left: 5px solid;
      padding-left: 10px;
    }
    .chain-distributor {
      border-color: var(--distributor-color);
    }
    .chain-retailer {
      border-color: var(--retailer-color);
    }
    .chain-main {
      border-color: var(--main-color);
    }
    .btn-distributor {
      background-color: var(--distributor-color);
      color: white;
    }
    .btn-retailer {
      background-color: var(--retailer-color);
      color: white;
    }
    .btn-main {
      background-color: var(--main-color);
      color: white;
    }
    .inventory-item {
      padding: 10px;
      border-bottom: 1px solid #f0f0f0;
    }
    .inventory-item:last-child {
      border-bottom: none;
    }
  </style>
</head>
<body>
  <!-- Top Header with Role Selector -->
  <div class="top-header">
    <div class="container-fluid">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h3><i class="bi bi-link-45deg"></i> SupplyChain Ledger Network</h3>
        </div>
        <div class="col-md-4 text-end">
          <div class="d-flex justify-content-end align-items-center">
            <span class="me-2">Role:</span>
            <select id="roleSelector" class="form-select form-select-sm" style="width: auto;">
              <option value="distributor">Distributor Staff</option>
              <option value="retailer">Retailer Staff</option>
              <option value="admin">System Administrator</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Sidebar Navigation -->
  <nav class="col-md-3 col-lg-2 d-md-block sidebar">
    <div class="position-sticky">
      <ul class="nav flex-column">
        <li class="nav-item">
          <a class="nav-link active" href="#dashboard" data-view="dashboard">
            <i class="bi bi-speedometer2"></i> Dashboard
          </a>
        </li>
        <li class="nav-item distributor-nav">
          <a class="nav-link" href="#distributor-inventory" data-view="distributor-inventory">
            <i class="bi bi-box"></i> Distributor Inventory
          </a>
        </li>
        <li class="nav-item retailer-nav">
          <a class="nav-link" href="#retailer-inventory" data-view="retailer-inventory">
            <i class="bi bi-shop"></i> Retailer Inventory
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#product-registry" data-view="product-registry">
            <i class="bi bi-upc-scan"></i> Product Registry
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#supply-chain" data-view="supply-chain">
            <i class="bi bi-truck"></i> Supply Chain
          </a>
        </li>
        <li class="nav-item admin-nav">
          <a class="nav-link" href="#network-monitor" data-view="network-monitor">
            <i class="bi bi-hdd-network"></i> Network Monitor
          </a>
        </li>
        <li class="nav-item admin-nav">
          <a class="nav-link" href="#cross-chain" data-view="cross-chain">
            <i class="bi bi-arrows-angle-contract"></i> Cross-Chain View
          </a>
        </li>
      </ul>
      
      <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
        <span>Network Status</span>
      </h6>
      <div class="px-3 py-2" id="sidebarNetworkStatus">
        Loading...
      </div>
    </div>
  </nav>
  
  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Dashboard View -->
    <div class="view-section" id="dashboard-view">
      <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h2>Enterprise Dashboard</h2>
        <div class="btn-toolbar mb-2 mb-md-0">
          <div class="btn-group me-2">
            <button type="button" class="btn btn-sm btn-outline-secondary" id="refreshDashboard">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-6 mb-4">
          <div class="card">
            <div class="card-header d-flex justify-content-between">
              <span>System Overview</span>
              <span class="text-muted">Real-time data</span>
            </div>
            <div class="card-body">
              <div class="flow-diagram">
                <div class="row">
                  <div class="col-md-5">
                    <div class="node node-distributor">
                      <h5>Distributor Chain</h5>
                      <div>Products: <span id="distributorProductCount">--</span></div>
                      <div>Transactions: <span id="distributorTxCount">--</span></div>
                    </div>
                  </div>
                  <div class="col-md-2 text-center">
                    <div style="margin-top: 40px;">
                      <i class="bi bi-arrow-left-right" style="font-size: 24px;"></i>
                      <div>Relay</div>
                    </div>
                  </div>
                  <div class="col-md-5">
                    <div class="node node-retailer">
                      <h5>Retailer Chain</h5>
                      <div>Products: <span id="retailerProductCount">--</span></div>
                      <div>Sales: <span id="retailerSalesCount">--</span></div>
                    </div>
                  </div>
                </div>
                <div class="row mt-3">
                  <div class="col-md-12 text-center">
                    <i class="bi bi-arrow-down" style="font-size: 24px;"></i>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-12">
                    <div class="node node-main">
                      <h5>Main Ledger</h5>
                      <div>Verified Products: <span id="mainProductCount">--</span></div>
                      <div>Supply Chain Events: <span id="mainEventCount">--</span></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6 mb-4">
          <div class="card">
            <div class="card-header">Recent Activity</div>
            <div class="card-body">
              <div class="transaction-log" id="recentActivityLog">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">Quick Actions</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4 mb-3">
                  <div class="d-grid">
                    <button type="button" class="btn btn-distributor" data-action="register-product">
                      <i class="bi bi-plus-circle"></i> Register New Product
                    </button>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="d-grid">
                    <button type="button" class="btn btn-retailer" data-action="record-event">
                      <i class="bi bi-calendar-event"></i> Record Supply Chain Event
                    </button>
                  </div>
                </div>
                <div class="col-md-4 mb-3">
                  <div class="d-grid">
                    <button type="button" class="btn btn-main" data-action="lookup-product">
                      <i class="bi bi-search"></i> Look Up Product
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Distributor Inventory View -->
    <div class="view-section" id="distributor-inventory-view" style="display: none;">
      <h2 class="chain-title chain-distributor">Distributor Inventory Management</h2>
      
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Available Inventory</div>
            <div class="card-body">
              <div class="input-group mb-3">
                <input type="text" class="form-control" placeholder="Search products..." id="distributorSearchInput">
                <button class="btn btn-outline-secondary" type="button">
                  <i class="bi bi-search"></i>
                </button>
              </div>
              
              <div class="inventory-list" id="distributorInventoryList">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Manage Product</div>
            <div class="card-body">
              <form id="distributorProductForm">
                <div class="mb-3">
                  <label class="form-label">Product ID</label>
                  <input type="text" class="form-control" id="distributorProductId">
                </div>
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" id="distributorProductName">
                </div>
                <div class="mb-3">
                  <label class="form-label">Quantity</label>
                  <input type="number" class="form-control" id="distributorProductQuantity" min="1" value="1">
                </div>
                <div class="mb-3">
                  <label class="form-label">Current Location</label>
                  <input type="text" class="form-control" id="distributorProductLocation" value="Distributor Warehouse">
                </div>
                
                <div class="d-flex justify-content-between">
                  <button type="button" class="btn btn-distributor" id="distributorAddBtn">
                    <i class="bi bi-plus-circle"></i> Add to Inventory
                  </button>
                  <button type="button" class="btn btn-outline-success" id="distributorShipBtn">
                    <i class="bi bi-truck"></i> Ship to Retailer
                  </button>
                </div>
              </form>
            </div>
          </div>
          
          <div class="card mt-4">
            <div class="card-header">Recent Shipments</div>
            <div class="card-body">
              <div id="distributorShipmentsList" class="transaction-log">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Retailer Inventory View -->
    <div class="view-section" id="retailer-inventory-view" style="display: none;">
      <h2 class="chain-title chain-retailer">Retailer Store Operations</h2>
      
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">
                <span>Store Inventory</span>
                <button type="button" class="btn btn-sm btn-outline-success" id="retailerRefreshBtn">
                  <i class="bi bi-arrow-clockwise"></i> Refresh
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="input-group mb-3">
                <input type="text" class="form-control" placeholder="Search products..." id="retailerSearchInput">
                <button class="btn btn-outline-secondary" type="button">
                  <i class="bi bi-search"></i>
                </button>
              </div>
              
              <div class="inventory-list" id="retailerInventoryList">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card mt-4">
            <div class="card-header">Pending Receipts</div>
            <div class="card-body">
              <div id="retailerReceiptsList" class="transaction-log">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Record Sale</div>
            <div class="card-body">
              <form id="retailerSaleForm">
                <div class="mb-3">
                  <label class="form-label">Product ID</label>
                  <input type="text" class="form-control" id="retailerSaleProductId">
                </div>
                <div class="mb-3">
                  <label class="form-label">Quantity</label>
                  <input type="number" class="form-control" id="retailerSaleQuantity" min="1" value="1">
                </div>
                <div class="mb-3">
                  <label class="form-label">Store Location</label>
                  <select class="form-control" id="retailerStoreLocation">
                    <option value="Store #123">Store #123</option>
                    <option value="Store #456">Store #456</option>
                    <option value="Online Store">Online Store</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Customer ID</label>
                  <input type="text" class="form-control" id="retailerCustomerId" placeholder="Optional">
                </div>
                
                <div class="d-grid">
                  <button type="button" class="btn btn-retailer" id="retailerSaleBtn">
                    <i class="bi bi-cart-check"></i> Complete Sale
                  </button>
                </div>
              </form>
            </div>
          </div>
          
          <div class="card mt-4">
            <div class="card-header">Recent Sales</div>
            <div class="card-body">
              <div id="retailerSalesList" class="transaction-log">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Product Registry View -->
    <div class="view-section" id="product-registry-view" style="display: none;">
      <h2>Product Registry <span class="badge chain-main">Main Chain</span></h2>
      
      <div class="row mt-4">
        <div class="col-md-5">
          <div class="card">
            <div class="card-header">Register New Product</div>
            <div class="card-body">
              <form id="registerForm">
                <div class="mb-3">
                  <label class="form-label">Product ID</label>
                  <input type="text" class="form-control" id="newProductId">
                </div>
                <div class="mb-3">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" id="productName">
                </div>
                <div class="mb-3">
                  <label class="form-label">Manufacturer</label>
                  <input type="text" class="form-control" id="manufacturer">
                </div>
                <div class="mb-3">
                  <label class="form-label">Attributes (JSON)</label>
                  <textarea class="form-control" id="attributes">{"origin": "USA", "category": "Electronics"}</textarea>
                </div>
                <button type="submit" class="btn btn-main">
                  <i class="bi bi-plus-circle"></i> Register Product
                </button>
              </form>
            </div>
          </div>
        </div>
        
        <div class="col-md-7">
          <div class="card">
            <div class="card-header">Product Lookup</div>
            <div class="card-body">
              <div class="input-group mb-3">
                <input type="text" id="productId" class="form-control" placeholder="Enter Product ID">
                <button class="btn btn-outline-secondary" id="lookupBtn">
                  <i class="bi bi-search"></i> Lookup
                </button>
              </div>
              <div id="productInfo" class="mt-3">
                <div class="text-center text-muted">
                  <i class="bi bi-upc-scan" style="font-size: 3rem;"></i>
                  <p>Enter a product ID to view details</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Supply Chain View -->
    <div class="view-section" id="supply-chain-view" style="display: none;">
      <h2>Supply Chain Management</h2>
      
      <div class="row mt-4">
        <div class="col-md-5">
          <div class="card">
            <div class="card-header">Record Supply Chain Event</div>
            <div class="card-body">
              <form id="eventForm">
                <div class="mb-3">
                  <label class="form-label">Product ID</label>
                  <input type="text" class="form-control" id="eventProductId">
                </div>
                <div class="mb-3">
                  <label class="form-label">Event Type</label>
                  <select class="form-control" id="eventType">
                    <option value="MANUFACTURED">Manufactured</option>
                    <option value="PACKAGED">Packaged</option>
                    <option value="SHIPPED">Shipped</option>
                    <option value="DISTRIBUTOR_RECEIVED">Distributor Received</option>
                    <option value="RETAILER_RECEIVED">Retailer Received</option>
                    <option value="SHELVED">Placed on Shelf</option>
                    <option value="SOLD">Sold</option>
                    <option value="RETURNED">Returned</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Location</label>
                  <input type="text" class="form-control" id="location">
                </div>
                <div class="mb-3">
                  <label class="form-label">Handler</label>
                  <input type="text" class="form-control" id="handler">
                </div>
                <div class="mb-3">
                  <label class="form-label">Additional Data (JSON)</label>
                  <textarea class="form-control" id="eventData">{}</textarea>
                </div>
                <button type="submit" class="btn btn-primary">
                  <i class="bi bi-calendar-event"></i> Record Event
                </button>
              </form>
            </div>
          </div>
        </div>
        
        <div class="col-md-7">
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center">
                <span>Recent Supply Chain Events</span>
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="showAllChainsSwitch" checked>
                  <label class="form-check-label" for="showAllChainsSwitch">Show all chains</label>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div id="supplyChainEvents" class="transaction-log">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card mt-4">
            <div class="card-header">Product Journey Visualization</div>
            <div class="card-body">
              <div class="input-group mb-3">
                <input type="text" id="journeyProductId" class="form-control" placeholder="Enter Product ID">
                <button class="btn btn-outline-secondary" id="viewJourneyBtn">
                  <i class="bi bi-map"></i> View Journey
                </button>
              </div>
              <div id="productJourney" class="mt-3">
                <!-- Product journey will be displayed here -->
                <div class="text-center text-muted">
                  <i class="bi bi-signpost" style="font-size: 3rem;"></i>
                  <p>Enter a product ID to view its journey</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Network Monitor View -->
    <div class="view-section" id="network-monitor-view" style="display: none;">
      <h2>Network Monitor <span class="badge bg-danger">Admin Only</span></h2>
      
      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header">Blockchain Network Status</div>
            <div class="card-body">
              <div id="detailedNetworkStatus">
                <div class="text-center py-4">
                  <div class="spinner-border text-secondary" role="status">
                    <span class="visually-hidden">Loading...</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card mt-4">
            <div class="card-header">Network Actions</div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6 mb-2">
                  <div class="d-grid">
                    <button class="btn btn-outline-primary" id="setupStreamsBtn">
                      <i class="bi bi-database-add"></i> Setup Required Streams
                    </button>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="d-grid">
                    <button class="btn btn-outline-secondary" id="forceBlocksBtn">
                      <i class="bi bi-box"></i> Force Mine Blocks
                    </button>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                  <div class="d-grid">
                    <button class="btn btn-outline-info" id="syncMerkleRootsBtn">
                      <i class="bi bi-arrow-repeat"></i> Sync Merkle Roots
                    </button>
                  </div>
                </div>
                <div class="col-md-6 mb-2">
                    <div class="d-grid">
                      <button class="btn btn-outline-danger" id="checkPeersBtn">
                        <i class="bi bi-check-circle"></i> Check Peer Connections
                      </button>
                    </div>
                  </div>
                </div>
                <div class="mt-3">
                  <div class="alert alert-info d-flex align-items-center" role="alert">
                    <i class="bi bi-info-circle-fill me-2"></i>
                    <div>Admin actions affect the underlying blockchain network configurations.</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Block Explorer</div>
              <div class="card-body">
                <div class="d-flex mb-3">
                  <select class="form-select me-2" id="networkExplorerChain">
                    <option value="main-chain">Main Chain</option>
                    <option value="distributor-chain">Distributor Chain</option>
                    <option value="retailer-chain">Retailer Chain</option>
                  </select>
                  <button class="btn btn-outline-secondary" id="refreshBlocksBtn">
                    <i class="bi bi-arrow-clockwise"></i>
                  </button>
                </div>
                <div id="blockExplorer">
                  <div class="text-center py-4">
                    <div class="spinner-border text-secondary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="card mt-4">
              <div class="card-header">System Logs</div>
              <div class="card-body">
                <div id="systemLogs" class="transaction-log">
                  <div class="text-center py-4">
                    <div class="spinner-border text-secondary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Cross-Chain View -->
      <div class="view-section" id="cross-chain-view" style="display: none;">
        <h2>Cross-Chain Data Flow <span class="badge bg-danger">Admin Only</span></h2>
        
        <div class="row mt-4">
          <div class="col-md-12">
            <div class="card">
              <div class="card-header">Transaction Relays</div>
              <div class="card-body">
                <div class="flow-diagram p-4">
                  <div class="row text-center">
                    <div class="col-md-4">
                      <div class="node node-distributor p-4">
                        <h5>Distributor Chain</h5>
                        <div class="mt-3 mb-3">
                          <i class="bi bi-box-seam" style="font-size: 2rem;"></i>
                        </div>
                        <div class="text-start small">
                          <div><strong>IP:</strong> 127.0.0.1:5000</div>
                          <div><strong>Blocks:</strong> <span id="crossDistBlockHeight">--</span></div>
                          <div><strong>Peers:</strong> <span id="crossDistPeers">--</span></div>
                        </div>
                      </div>
                      <div class="mt-3">
                        <div class="d-inline-block p-2 bg-light rounded">
                          <i class="bi bi-arrow-up"></i> Outgoing: <span id="distOutgoing">--</span>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="node node-main p-4">
                        <h5>Main Chain</h5>
                        <div class="mt-3 mb-3">
                          <i class="bi bi-link-45deg" style="font-size: 2rem;"></i>
                        </div>
                        <div class="text-start small">
                          <div><strong>IP:</strong> 127.0.0.1:6000</div>
                          <div><strong>Blocks:</strong> <span id="crossMainBlockHeight">--</span></div>
                          <div><strong>Peers:</strong> <span id="crossMainPeers">--</span></div>
                        </div>
                      </div>
                      <div class="mt-3">
                        <div class="p-2 bg-warning rounded">
                          <i class="bi bi-arrow-repeat"></i> Relay Server
                        </div>
                      </div>
                    </div>
                    <div class="col-md-4">
                      <div class="node node-retailer p-4">
                        <h5>Retailer Chain</h5>
                        <div class="mt-3 mb-3">
                          <i class="bi bi-shop" style="font-size: 2rem;"></i>
                        </div>
                        <div class="text-start small">
                          <div><strong>IP:</strong> 127.0.0.1:7000</div>
                          <div><strong>Blocks:</strong> <span id="crossRetailBlockHeight">--</span></div>
                          <div><strong>Peers:</strong> <span id="crossRetailPeers">--</span></div>
                        </div>
                      </div>
                      <div class="mt-3">
                        <div class="d-inline-block p-2 bg-light rounded">
                          <i class="bi bi-arrow-up"></i> Outgoing: <span id="retailOutgoing">--</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row mt-4">
                    <div class="col-12 text-center">
                      <div class="p-3 bg-light rounded">
                        <h6>Last Sync: <span id="lastSyncTime">--</span></h6>
                        <div id="syncStatus">
                          <span class="badge bg-success">Operational</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row mt-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Cross-Chain Transfers</div>
              <div class="card-body">
                <div id="crossChainTransfers" class="transaction-log">
                  <div class="text-center py-4">
                    <div class="spinner-border text-secondary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">Merkle Root Verifications</div>
              <div class="card-body">
                <div id="merkleVerifications" class="transaction-log">
                  <div class="text-center py-4">
                    <div class="spinner-border text-secondary" role="status">
                      <span class="visually-hidden">Loading...</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  
    <script>
      const API_BASE_URL = 'http://localhost:3000/api';
      let currentRole = 'distributor';
      let lastActivity = {};
  
      // Initialize the application
      document.addEventListener('DOMContentLoaded', function() {
        // Set up role selector
        document.getElementById('roleSelector').addEventListener('change', function(e) {
          currentRole = e.target.value;
          updateUIForRole(currentRole);
          fetchNetworkStatus();
          showView('dashboard');
        });
        
        // Set up navigation
        document.querySelectorAll('.nav-link').forEach(link => {
          link.addEventListener('click', function(e) {
            e.preventDefault();
            const view = this.dataset.view;
            showView(view);
            
            // Remove active class from all links
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            // Add active class to clicked link
            this.classList.add('active');
          });
        });
        
        // Quick action buttons
        document.querySelectorAll('[data-action]').forEach(button => {
          button.addEventListener('click', function() {
            const action = this.dataset.action;
            handleQuickAction(action);
          });
        });
        
        // Form submissions
        setupFormSubmissions();
        
        // Network monitor buttons
        setupNetworkActions();
        
        // Initial UI setup
        updateUIForRole(currentRole);
        fetchNetworkStatus();
        fetchDashboardStats();
        
        // Set up refresh handlers
        document.getElementById('refreshDashboard').addEventListener('click', fetchDashboardStats);
      });
  
      // Update UI based on role
      function updateUIForRole(role) {
        // Show/hide role-specific navigation
        document.querySelectorAll('.distributor-nav').forEach(el => {
          el.style.display = (role === 'distributor' || role === 'admin') ? '' : 'none';
        });
        
        document.querySelectorAll('.retailer-nav').forEach(el => {
          el.style.display = (role === 'retailer' || role === 'admin') ? '' : 'none';
        });
        
        document.querySelectorAll('.admin-nav').forEach(el => {
          el.style.display = role === 'admin' ? '' : 'none';
        });
      }
  
      // Show the selected view, hide others
      function showView(viewName) {
        document.querySelectorAll('.view-section').forEach(section => {
          section.style.display = 'none';
        });
        
        const viewElement = document.getElementById(`${viewName}-view`);
        if (viewElement) {
          viewElement.style.display = 'block';
          
          // Load view-specific data
          switch(viewName) {
            case 'dashboard':
              fetchDashboardStats();
              break;
            case 'distributor-inventory':
              if (currentRole === 'distributor' || currentRole === 'admin') {
                fetchDistributorInventory();
              }
              break;
            case 'retailer-inventory':
              if (currentRole === 'retailer' || currentRole === 'admin') {
                fetchRetailerInventory();
              }
              break;
            case 'product-registry':
              fetchProducts();
              break;
            case 'supply-chain':
              fetchSupplyChainEvents();
              break;
            case 'network-monitor':
              fetchDetailedNetworkStatus();
              break;
            case 'cross-chain':
              fetchCrossChainData();
              break;
          }
        }
      }
  
      // Setup form submissions
      function setupFormSubmissions() {
        // Product registration form
        document.getElementById('registerForm').addEventListener('submit', function(e) {
          e.preventDefault();
          
          const productData = {
            productId: document.getElementById('newProductId').value,
            name: document.getElementById('productName').value,
            manufacturer: document.getElementById('manufacturer').value,
            attributes: JSON.parse(document.getElementById('attributes').value)
          };
          
          registerProduct(productData);
        });
        
        // Other form handlers will be implemented similarly
      }
  
      // Network admin actions setup
      function setupNetworkActions() {
        document.getElementById('setupStreamsBtn').addEventListener('click', function() {
          setupRequiredStreams();
        });
        
        document.getElementById('forceBlocksBtn').addEventListener('click', function() {
          forceMineBlocks();
        });
        
        document.getElementById('syncMerkleRootsBtn').addEventListener('click', function() {
          syncMerkleRoots();
        });
        
        document.getElementById('checkPeersBtn').addEventListener('click', function() {
          checkPeerConnections();
        });
        
        document.getElementById('refreshBlocksBtn').addEventListener('click', function() {
          fetchBlockExplorer();
        });
      }
  
      // Fetch network status for sidebar
      function fetchNetworkStatus() {
        fetch(`${API_BASE_URL}/network/health`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Only show chains the current role has access to
              let html = '';
              
              if (currentRole === 'admin' || currentRole === 'distributor') {
                const distStatus = data.network['distributor-chain']?.mainNode.status === 'online';
                html += `<div class="mb-2">
                  <span class="network-status-indicator ${distStatus ? 'status-online' : 'status-offline'}"></span>
                  Distributor Chain
                </div>`;
              }
              
              if (currentRole === 'admin' || currentRole === 'retailer') {
                const retailStatus = data.network['retailer-chain']?.mainNode.status === 'online';
                html += `<div class="mb-2">
                  <span class="network-status-indicator ${retailStatus ? 'status-online' : 'status-offline'}"></span>
                  Retailer Chain
                </div>`;
              }
              
              if (currentRole === 'admin') {
                const mainStatus = data.network['main-chain']?.mainNode.status === 'online';
                html += `<div class="mb-2">
                  <span class="network-status-indicator ${mainStatus ? 'status-online' : 'status-offline'}"></span>
                  Main Chain
                </div>`;
              }
              
              document.getElementById('sidebarNetworkStatus').innerHTML = html;
            }
          })
          .catch(error => {
            console.error('Error fetching network status:', error);
            document.getElementById('sidebarNetworkStatus').innerHTML = 
              '<div class="text-danger"><i class="bi bi-exclamation-triangle"></i> Connection error</div>';
          });
      }
  
      // Fetch dashboard statistics
      function fetchDashboardStats() {
        fetch(`${API_BASE_URL}/dashboard/stats`)
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              // Update dashboard counts based on role access
              if (currentRole === 'admin' || currentRole === 'distributor') {
                document.getElementById('distributorProductCount').textContent = data.distributor.productCount;
                document.getElementById('distributorTxCount').textContent = data.distributor.transactionCount;
              } else {
                document.getElementById('distributorProductCount').textContent = '-- (No Access)';
                document.getElementById('distributorTxCount').textContent = '-- (No Access)';
              }
              
              if (currentRole === 'admin' || currentRole === 'retailer') {
                document.getElementById('retailerProductCount').textContent = data.retailer.productCount;
                document.getElementById('retailerSalesCount').textContent = data.retailer.salesCount;
              } else {
                document.getElementById('retailerProductCount').textContent = '-- (No Access)';
                document.getElementById('retailerSalesCount').textContent = '-- (No Access)';
              }
              
              // Main chain data is visible to all
              document.getElementById('mainProductCount').textContent = data.main.verifiedProducts;
              document.getElementById('mainEventCount').textContent = data.main.eventsCount;
              
              // Update recent activity log
              updateRecentActivity(data.recentActivity);
            }
          })
          .catch(error => {
            console.error('Error fetching dashboard stats:', error);
          });
      }
  
      // Update recent activity log
      function updateRecentActivity(activities) {
        if (!activities || activities.length === 0) {
          document.getElementById('recentActivityLog').innerHTML = 
            '<div class="text-center text-muted p-4">No recent activity found</div>';
          return;
        }
        
        let html = '';
        activities.forEach(activity => {
          // Only show activities from chains the current role can access
          if (currentRole !== 'admin') {
            if (activity.chain === 'distributor-chain' && currentRole !== 'distributor') return;
            if (activity.chain === 'retailer-chain' && currentRole !== 'retailer') return;
          }
          
          const time = new Date(activity.timestamp).toLocaleTimeString();
          const chainClass = activity.chain.includes('distributor') ? 'distributor' : 
                            activity.chain.includes('retailer') ? 'retailer' : 'main-chain';
          
          html += `<div class="d-flex align-items-start mb-2">
            <span class="department-icon ${chainClass} mt-1"></span>
            <div>
              <div class="d-flex justify-content-between">
                <strong>${activity.type}</strong>
                <small class="text-muted">${time}</small>
              </div>
              <div>${activity.description}</div>
            </div>
          </div>`;
        });
        
        document.getElementById('recentActivityLog').innerHTML = html;
      }
  
      // Handle quick actions from dashboard
      function handleQuickAction(action) {
        switch(action) {
          case 'register-product':
            showView('product-registry');
            break;
          case 'record-event':
            showView('supply-chain');
            break;
          case 'lookup-product':
            showView('product-registry');
            setTimeout(() => {
              document.getElementById('productId').focus();
            }, 100);
            break;
        }
      }
  
      // API functions will be implemented here
      function registerProduct(productData) {
        // Show loading state
        const submitBtn = document.querySelector('#registerForm button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';
        
        fetch(`${API_BASE_URL}/supply-chain/register-product`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(productData)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert('Product registered successfully!');
            document.getElementById('registerForm').reset();
          } else {
            alert(`Error: ${data.message}`);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert(`Error: ${error.message}`);
        })
        .finally(() => {
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalText;
        });
      }
  
      // Add stub functions for API calls that will be implemented later
      function fetchProducts() {}
      function fetchDistributorInventory() {}
      function fetchRetailerInventory() {}
      function fetchSupplyChainEvents() {}
      function fetchDetailedNetworkStatus() {}
      function fetchCrossChainData() {}
      function setupRequiredStreams() {}
      function forceMineBlocks() {}
      function syncMerkleRoots() {}
      function checkPeerConnections() {}
      function fetchBlockExplorer() {}
    </script>
  </body>
  </html>